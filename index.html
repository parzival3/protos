<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number Pyramid with Filters</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            margin: 0 auto;
        }
        .controls {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .control-section {
            margin-bottom: 15px;
        }
        .control-section h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #333;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 8px 16px;
            border: 2px solid #333;
            background-color: white;
            cursor: pointer;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            transition: all 0.2s;
        }
        button.active {
            background-color: #333;
            color: white;
        }
        button:hover {
            background-color: #666;
            color: white;
        }
        .pyramid {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow-x: auto;
            overflow-y: auto;
            width: 100%;
            min-height: 500px;
            text-align: center;
        }
        .pyramid-inner {
            transform-origin: top center;
            line-height: 1.8;
            font-size: 14px;
            display: inline-block;
            text-align: left;
        }
        .row {
            margin-bottom: 5px;
            white-space: nowrap;
            text-align: center;
        }
        .number {
            display: inline-block;
            width: 50px;
            padding: 4px 6px;
            margin: 2px;
            border-radius: 3px;
            transition: opacity 0.3s;
            text-align: center;
            box-sizing: border-box;
            position: relative;
            cursor: pointer;
        }
        .number:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            white-space: nowrap;
            font-size: 12px;
            z-index: 1000;
            margin-bottom: 5px;
            pointer-events: none;
        }
        .number:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #333;
            margin-bottom: -5px;
            pointer-events: none;
        }
        .number.prime {
            background-color: #ffeb3b;
            font-weight: bold;
        }
        .number.hidden {
            opacity: 0.1;
            text-decoration: line-through;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <div class="control-section">
                <h3>Prime Numbers</h3>
                <button id="togglePrimes" class="active">Show Primes</button>
            </div>
            <div class="control-section">
                <h3>Highlight Divisors (Click to choose color)</h3>
                <div class="button-group" style="flex-direction: column; gap: 5px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="divisor-btn" data-divisor="2">Divisible by 2</button>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" class="hide-checkbox" data-divisor="2">
                            <span>Hide</span>
                        </label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="divisor-btn" data-divisor="3">Divisible by 3</button>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" class="hide-checkbox" data-divisor="3">
                            <span>Hide</span>
                        </label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="divisor-btn" data-divisor="5">Divisible by 5</button>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" class="hide-checkbox" data-divisor="5">
                            <span>Hide</span>
                        </label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="divisor-btn" data-divisor="7">Divisible by 7</button>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" class="hide-checkbox" data-divisor="7">
                            <span>Hide</span>
                        </label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="divisor-btn" data-divisor="11">Divisible by 11</button>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" class="hide-checkbox" data-divisor="11">
                            <span>Hide</span>
                        </label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="divisor-btn" data-divisor="13">Divisible by 13</button>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" class="hide-checkbox" data-divisor="13">
                            <span>Hide</span>
                        </label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="divisor-btn" data-divisor="17">Divisible by 17</button>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" class="hide-checkbox" data-divisor="17">
                            <span>Hide</span>
                        </label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="divisor-btn" data-divisor="21">Divisible by 21</button>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" class="hide-checkbox" data-divisor="21">
                            <span>Hide</span>
                        </label>
                    </div>
                </div>
            </div>
            <input type="color" id="colorPicker" style="display: none;" value="#00ff00">
            <div class="control-section">
                <h3>Zoom</h3>
                <div class="button-group">
                    <button id="zoomOut">Zoom Out (-)</button>
                    <button id="zoomReset">Reset (100%)</button>
                    <button id="zoomIn">Zoom In (+)</button>
                    <span id="zoomLevel" style="margin-left: 10px; font-weight: bold;">100%</span>
                </div>
            </div>
        </div>
        <div class="pyramid">
            <div class="pyramid-inner" id="pyramid">
                <div class="loading">Loading database...</div>
            </div>
        </div>
    </div>

    <script>
        let database = null;
        let showPrimes = true;
        let divisorColors = {}; // Map divisors to their highlight colors
        let hiddenDivisors = new Set(); // Set of divisors to hide
        let zoomLevel = 100; // Zoom percentage
        let longPressTimer = null;
        let currentDivisorBtn = null;

        // Load the database
        async function loadDatabase() {
            try {
                const response = await fetch('numbers_database.json');
                database = await response.json();
                createPyramid();
                setupControls();
            } catch (error) {
                document.getElementById('pyramid').innerHTML = 
                    '<div class="loading">Error loading database. Make sure numbers_database.json is in the same directory.</div>';
                console.error('Error loading database:', error);
            }
        }

        function setupControls() {
            // Prime toggle
            document.getElementById('togglePrimes').addEventListener('click', function() {
                showPrimes = !showPrimes;
                this.classList.toggle('active');
                this.textContent = showPrimes ? 'Show Primes' : 'Hide Primes';
                updatePyramidVisibility();
            });

            // Divisor buttons - click to choose color or deselect
            document.querySelectorAll('.divisor-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const divisor = parseInt(this.dataset.divisor);
                    currentDivisorBtn = this;
                    
                    if (divisorColors[divisor]) {
                        // Already selected - deselect it
                        delete divisorColors[divisor];
                        this.classList.remove('active');
                        this.style.backgroundColor = '';
                        this.style.color = '';
                        updatePyramidVisibility();
                    } else {
                        // Not selected - open color picker
                        const colorPicker = document.getElementById('colorPicker');
                        colorPicker.value = '#00ff00';
                        colorPicker.click();
                    }
                });
            });
            
            // Color picker change handler
            document.getElementById('colorPicker').addEventListener('change', function() {
                if (currentDivisorBtn) {
                    const divisor = parseInt(currentDivisorBtn.dataset.divisor);
                    const color = this.value;
                    divisorColors[divisor] = color;
                    currentDivisorBtn.classList.add('active');
                    currentDivisorBtn.style.backgroundColor = color;
                    currentDivisorBtn.style.color = '#fff';
                    updatePyramidVisibility();
                }
            });
            
            // Hide checkboxes
            document.querySelectorAll('.hide-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const divisor = parseInt(this.dataset.divisor);
                    if (this.checked) {
                        hiddenDivisors.add(divisor);
                    } else {
                        hiddenDivisors.delete(divisor);
                    }
                    updatePyramidVisibility();
                });
            });

            // Zoom controls
            document.getElementById('zoomIn').addEventListener('click', function() {
                zoomLevel = Math.min(200, zoomLevel + 10);
                updateZoom();
            });

            document.getElementById('zoomOut').addEventListener('click', function() {
                zoomLevel = Math.max(20, zoomLevel - 10);
                updateZoom();
            });

            document.getElementById('zoomReset').addEventListener('click', function() {
                zoomLevel = 100;
                updateZoom();
            });
        }

        function createPyramid() {
            const pyramid = document.getElementById('pyramid');
            pyramid.innerHTML = '';
            
            let number = 1;
            let row = 1;
            const totalNumbers = 10000;
            
            // Keep adding rows until we've displayed all numbers
            while (number <= totalNumbers) {
                let rowDiv = document.createElement('div');
                rowDiv.className = 'row';
                
                const numbersInRow = 2 * row - 1; // 1, 3, 5, 7, 9, ...
                
                for (let i = 0; i < numbersInRow && number <= totalNumbers; i++) {
                    const numData = database[number];
                    const span = document.createElement('span');
                    span.className = 'number';
                    span.dataset.number = number;
                    span.textContent = number;
                    
                    // Add tooltip with divisors
                    if (numData) {
                        const divisorsList = numData.divisors.join(', ');
                        const primeLabel = numData.is_prime ? ' (Prime)' : '';
                        span.dataset.tooltip = `Divisors: ${divisorsList}${primeLabel}`;
                    }
                    
                    if (numData && numData.is_prime) {
                        span.classList.add('prime');
                    }
                    
                    rowDiv.appendChild(span);
                    number++;
                }

                pyramid.appendChild(rowDiv);
                row++;
            }
            
            // Center the pyramid after creation
            setTimeout(centerPyramid, 100);
        }
        
        function centerPyramid() {
            const pyramidContainer = document.querySelector('.pyramid');
            const pyramidInner = document.getElementById('pyramid');
            const containerWidth = pyramidContainer.clientWidth;
            const contentWidth = pyramidInner.scrollWidth;
            
            if (contentWidth > containerWidth) {
                pyramidContainer.scrollLeft = (contentWidth - containerWidth) / 2;
            }
        }

        function updatePyramidVisibility() {
            document.querySelectorAll('.number').forEach(span => {
                const num = parseInt(span.dataset.number);
                const numData = database[num];
                
                // Reset background color and visibility
                span.style.backgroundColor = '';
                span.classList.remove('hidden');
                
                // Check if number should be hidden by checkbox
                let shouldHide = false;
                for (let divisor of hiddenDivisors) {
                    if (num % divisor === 0) {
                        shouldHide = true;
                        break;
                    }
                }
                
                // Apply divisor colors (last one wins if multiple match)
                if (!shouldHide) {
                    for (let divisor in divisorColors) {
                        if (num % divisor === 0) {
                            span.style.backgroundColor = divisorColors[divisor];
                        }
                    }
                }
                
                // Restore prime highlighting if enabled and no divisor color applied
                if (numData.is_prime && !span.style.backgroundColor && !shouldHide) {
                    span.classList.add('prime');
                } else if (!numData.is_prime || span.style.backgroundColor) {
                    span.classList.remove('prime');
                }
                
                // Hide if checkbox is checked for a divisor
                if (shouldHide) {
                    span.classList.add('hidden');
                }
                
                // If it's prime and we're hiding primes, hide it
                if (numData.is_prime && !showPrimes) {
                    span.classList.add('hidden');
                }
            });
        }

        function updateZoom() {
            const pyramidInner = document.getElementById('pyramid');
            pyramidInner.style.transform = `scale(${zoomLevel / 100})`;
            document.getElementById('zoomLevel').textContent = zoomLevel + '%';
            
            // Recenter after zoom
            setTimeout(centerPyramid, 100);
        }

        // Load database on page load
        loadDatabase();
    </script>
</body>
</html>
